<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZUNEKO - Incentive Calculation System</title>
    <link rel="stylesheet" href="/static/css/index.css">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="brand">
                <div class="brand-logo">Z</div>
                <div class="brand-info">
                    <h1 class="brand-name">ZUNEKO</h1>
                    <p class="brand-subtitle">Incentive Calculation System</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="user-profile">
                    <span class="user-name">Admin User</span>
                    <span class="user-role">Operations</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav">
        <button class="nav-btn active" data-screen="dashboard">
            <span class="nav-icon">üìä</span>
            <span>Dashboard</span>
        </button>
        <button class="nav-btn" data-screen="upload">
            <span class="nav-icon">üì§</span>
            <span>Upload Data</span>
        </button>
        <button class="nav-btn" data-screen="calculate">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>Run Calculations</span>
        </button>
        <button class="nav-btn" data-screen="results">
            <span class="nav-icon">üìã</span>
            <span>View Results</span>
        </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- DASHBOARD SCREEN -->
        <section id="dashboard" class="screen active">
            <div class="screen-header">
                <h2>Dashboard</h2>
                <p class="screen-description">System overview and calculation status</p>
            </div>

            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Total Incentives Calculated</div>
                    <div class="kpi-value" id="dashTotalIncentives">‚Çπ0</div>
                    <div class="kpi-meta">Current Month</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Salespeople Processed</div>
                    <div class="kpi-value" id="dashTotalEmployees">0</div>
                    <div class="kpi-meta">Across all branches</div>
                </div>
                <div class="kpi-card kpi-highlight">
                    <div class="kpi-label">Top Performer</div>
                    <div class="kpi-value" id="dashTopPerformer">-</div>
                    <div class="kpi-meta">Highest incentive earned</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Last Calculation Run</div>
                    <div class="kpi-value" id="dashLastRun">-</div>
                    <div class="kpi-meta status-success" id="dashStatus">‚óè Not yet run</div>
                </div>
            </div>

            <!-- Primary Actions -->
            <div class="action-section">
                <h3>Primary Actions</h3>
                <div class="action-grid">
                    <button class="action-card" data-navigate="upload">
                        <div class="action-icon">üì§</div>
                        <div class="action-content">
                            <h4>Upload Data</h4>
                            <p>Import sales data and incentive rules</p>
                        </div>
                    </button>
                    <button class="action-card" data-navigate="calculate">
                        <div class="action-icon">‚öôÔ∏è</div>
                        <div class="action-content">
                            <h4>Run Calculation</h4>
                            <p>Process incentives for selected period</p>
                        </div>
                    </button>
                    <button class="action-card" data-navigate="results">
                        <div class="action-icon">üìã</div>
                        <div class="action-content">
                            <h4>View Results</h4>
                            <p>Review calculated incentives and exceptions</p>
                        </div>
                    </button>
                </div>
            </div>
        </section>

        <!-- UPLOAD DATA SCREEN -->
        <section id="upload" class="screen">
            <div class="screen-header">
                <h2>Upload Data</h2>
                <p class="screen-description">Import sales data and configure incentive rules</p>
            </div>

            <!-- Sales Data Upload -->
            <div class="upload-section">
                <h3>A. Sales Data Upload</h3>
                <div class="upload-card">
                    <div class="upload-area">
                        <input type="file" id="salesFileInput" accept=".csv" hidden>
                        <div class="upload-dropzone" id="salesDropzone">
                            <div class="upload-icon">üìÅ</div>
                            <p class="upload-text">Drop CSV file here or click to browse</p>
                            <p class="upload-hint">Required format: .csv (max 50MB)</p>
                        </div>
                    </div>
                    
                    <div class="required-columns">
                        <h4>Required Columns</h4>
                        <div class="column-list">
                            <span class="column-badge">Employee_ID</span>
                            <span class="column-badge">Branch</span>
                            <span class="column-badge">Role</span>
                            <span class="column-badge">Vehicle_Sold</span>
                            <span class="column-badge">Units_Sold</span>
                            <span class="column-badge">Sale_Date</span>
                        </div>
                    </div>

                    <div id="salesPreview" class="data-preview" style="display: none;">
                        <h4>Data Preview</h4>
                        <div class="preview-meta">
                            <span id="salesRowCount"></span>
                            <span id="salesValidation"></span>
                        </div>
                        <div class="table-wrapper">
                            <table class="preview-table" id="salesPreviewTable"></table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Structured Rules Upload -->
            <div class="upload-section">
                <h3>B. Structured Incentive Rules Upload</h3>
                <div class="upload-card">
                    <div class="upload-area">
                        <input type="file" id="rulesFileInput" accept=".csv" hidden>
                        <div class="upload-dropzone" id="rulesDropzone">
                            <div class="upload-icon">üìã</div>
                            <p class="upload-text">Drop CSV file here or click to browse</p>
                            <p class="upload-hint">Structured incentive rules (slab-based)</p>
                        </div>
                    </div>

                    <div class="required-columns">
                        <h4>Required Columns</h4>
                        <div class="column-list">
                            <span class="column-badge">Role</span>
                            <span class="column-badge">Vehicle_Type</span>
                            <span class="column-badge">Min_Units</span>
                            <span class="column-badge">Max_Units</span>
                            <span class="column-badge">Incentive_Per_Unit</span>
                            <span class="column-badge">Valid_From</span>
                            <span class="column-badge">Valid_To</span>
                        </div>
                    </div>

                    <div id="rulesStatus" class="upload-status" style="display: none;"></div>
                </div>
            </div>

            <!-- Ad-Hoc Rules Upload -->
            <div class="upload-section">
                <h3>C. Ad-Hoc Incentive Rules Upload</h3>
                <div class="upload-card">
                    <div class="upload-tabs">
                        <button class="tab-btn active" data-tab="file">File Upload</button>
                        <button class="tab-btn" data-tab="manual">Manual Entry</button>
                    </div>

                    <div class="tab-content active" id="fileTab">
                        <div class="upload-area">
                            <input type="file" id="adhocFileInput" accept=".txt,.pdf" hidden>
                            <div class="upload-dropzone" id="adhocDropzone">
                                <div class="upload-icon">üìÑ</div>
                                <p class="upload-text">Drop TXT or PDF file here or click to browse</p>
                                <p class="upload-hint">Unstructured ad-hoc rules or special incentives</p>
                            </div>
                        </div>

                        <div id="adhocParsed" class="parsed-rules" style="display: none;">
                            <h4>Parsed Rules Summary</h4>
                            <div class="confidence-indicator">
                                <span>Parsing Confidence:</span>
                                <span class="confidence-badge" id="confidenceBadge">High</span>
                            </div>
                            <div id="parsedContent" class="parsed-content"></div>
                        </div>
                    </div>

                    <div class="tab-content" id="manualTab">
                        <div class="form-group">
                            <label>Rule Description</label>
                            <textarea id="adhocText" rows="6" placeholder="e.g., All salespeople who sell 3+ SUVs in September get ‚Çπ5,000 bonus"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Valid From</label>
                                <input type="date" id="adhocFrom">
                            </div>
                            <div class="form-group">
                                <label>Valid To</label>
                                <input type="date" id="adhocTo">
                            </div>
                            <div class="form-group">
                                <label>Priority</label>
                                <select id="adhocPriority">
                                    <option value="high">High</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn-primary" id="addAdhocBtn">Add Ad-Hoc Rule</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- RUN CALCULATIONS SCREEN -->
        <section id="calculate" class="screen">
            <div class="screen-header">
                <h2>Run Calculations</h2>
                <p class="screen-description">Execute incentive calculation engine</p>
            </div>

            <div class="calc-container">
                <div class="calc-inputs">
                    <h3>Calculation Parameters</h3>
                    
                    <div class="form-group">
                        <label>Select Month</label>
                        <select id="calcMonth">
                            <option value="2025-09" selected>September 2025</option>
                            <option value="2025-08">August 2025</option>
                            <option value="2025-07">July 2025</option>
                            <option value="2025-06">June 2025</option>
                            <option value="2025-05">May 2025</option>
                            <option value="2025-04">April 2025</option>
                            <option value="2025-03">March 2025</option>
                            <option value="2025-02">February 2025</option>
                            <option value="2025-01">January 2025</option>
                        </select>
                    </div>

                    <button class="btn-primary btn-large" id="runCalcBtn">
                        <span class="btn-icon">‚ñ∂</span>
                        Run Calculation
                    </button>
                </div>

                <div class="calc-output" id="calcOutput" style="display: none;">
                    <h3>Calculation Results</h3>
                    
                    <div class="output-status">
                        <div class="status-indicator" id="statusIndicator">
                            <div class="spinner"></div>
                            <span id="statusText">Processing...</span>
                        </div>
                    </div>

                    <div class="output-metrics">
                        <div class="metric-row">
                            <span class="metric-label">Records Processed:</span>
                            <span class="metric-value" id="recordsProcessed">-</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Total Incentive:</span>
                            <span class="metric-value success" id="successCount">-</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Exceptions:</span>
                            <span class="metric-value error" id="exceptionsCount">-</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Execution Time:</span>
                            <span class="metric-value" id="execTime">-</span>
                        </div>
                    </div>

                    <button class="btn-secondary" id="viewResultsBtn">View Detailed Results ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- RESULTS SCREEN -->
        <section id="results" class="screen">
            <div class="screen-header">
                <div>
                    <h2>Incentive Results</h2>
                    <p class="screen-description">Calculated incentives for September 2025</p>
                </div>
            </div>

            <div class="results-summary">
                <div class="summary-item">
                    <span class="summary-label">Total Records:</span>
                    <span class="summary-value" id="resultsTotalRecords">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Incentives:</span>
                    <span class="summary-value" id="resultsTotalIncentives">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Top Performer:</span>
                    <span class="summary-value" id="resultsTopPerformer">-</span>
                </div>
            </div>

            <div class="table-container">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Employee ID</th>
                            <th>Branch</th>
                            <th>Role</th>
                            <th>Total Units</th>
                            <th>Structured (‚Çπ)</th>
                            <th>Ad-Hoc (‚Çπ)</th>
                            <th>Total (‚Çπ)</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                        <tr>
                            <td colspan="9" class="no-data">Loading data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

    </main>

    <!-- BREAKDOWN MODAL -->
    <div class="modal" id="breakdownModal">
        <div class="modal-overlay" onclick="closeBreakdown()"></div>
        <div class="modal-panel">
            <div class="modal-header">
                <h3>Incentive Breakdown</h3>
                <button class="modal-close" onclick="closeBreakdown()">√ó</button>
            </div>
            <div class="modal-body" id="breakdownContent">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <script src="/static/js/config.js"></script>
    <script src="/static/js/index.js"></script>
</body>
</html>